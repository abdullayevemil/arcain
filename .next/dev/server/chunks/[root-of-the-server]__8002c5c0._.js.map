{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/emil/Desktop/arcain/new/src/lib/data.ts"],"sourcesContent":["import { promises as fs } from \"fs\";\nimport path from \"path\";\nimport type { House, City, User } from \"@/types\";\n\nconst dataDir = path.join(process.cwd(), \"src/data\");\nconst usersTmpPath = \"/tmp/users.json\";\n\nexport async function readHouses(): Promise<House[]> {\n  const filePath = path.join(dataDir, \"houses.json\");\n  const data = await fs.readFile(filePath, \"utf-8\");\n  return JSON.parse(data);\n}\n\nexport async function writeHouses(houses: House[]): Promise<void> {\n  const filePath = path.join(dataDir, \"houses.json\");\n  try {\n    await fs.writeFile(filePath, JSON.stringify(houses, null, 2), \"utf-8\");\n  } catch {\n    // Read-only filesystem (e.g. Vercel): skip persist\n  }\n}\n\nexport async function readCities(): Promise<City[]> {\n  const filePath = path.join(dataDir, \"cities.json\");\n  const data = await fs.readFile(filePath, \"utf-8\");\n  return JSON.parse(data);\n}\n\nexport async function writeCities(cities: City[]): Promise<void> {\n  const filePath = path.join(dataDir, \"cities.json\");\n  try {\n    await fs.writeFile(filePath, JSON.stringify(cities, null, 2), \"utf-8\");\n  } catch {\n    // Read-only filesystem (e.g. Vercel): skip persist\n  }\n}\n\nfunction mergeUsersByEmail(fileUsers: User[], tmpUsers: User[]): User[] {\n  const byEmail = new Map<string, User>();\n  for (const u of fileUsers) byEmail.set(u.email.toLowerCase(), u);\n  for (const u of tmpUsers) byEmail.set(u.email.toLowerCase(), u);\n  return Array.from(byEmail.values());\n}\n\nexport async function readUsers(): Promise<User[]> {\n  const filePath = path.join(dataDir, \"users.json\");\n  const data = await fs.readFile(filePath, \"utf-8\");\n  const fileUsers: User[] = JSON.parse(data);\n  try {\n    const tmpData = await fs.readFile(usersTmpPath, \"utf-8\");\n    const tmpUsers: User[] = JSON.parse(tmpData);\n    return mergeUsersByEmail(fileUsers, tmpUsers);\n  } catch {\n    return fileUsers;\n  }\n}\n\nexport async function writeUsers(users: User[]): Promise<void> {\n  const filePath = path.join(dataDir, \"users.json\");\n  let fileUsers: User[];\n  try {\n    const data = await fs.readFile(filePath, \"utf-8\");\n    fileUsers = JSON.parse(data);\n  } catch {\n    fileUsers = [];\n  }\n  const merged = mergeUsersByEmail(fileUsers, users);\n  await fs.writeFile(usersTmpPath, JSON.stringify(merged, null, 2), \"utf-8\");\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;;;AAGA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACzC,MAAM,eAAe;AAEd,eAAe;IACpB,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS;IACpC,MAAM,OAAO,MAAM,yGAAE,CAAC,QAAQ,CAAC,UAAU;IACzC,OAAO,KAAK,KAAK,CAAC;AACpB;AAEO,eAAe,YAAY,MAAe;IAC/C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS;IACpC,IAAI;QACF,MAAM,yGAAE,CAAC,SAAS,CAAC,UAAU,KAAK,SAAS,CAAC,QAAQ,MAAM,IAAI;IAChE,EAAE,OAAM;IACN,mDAAmD;IACrD;AACF;AAEO,eAAe;IACpB,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS;IACpC,MAAM,OAAO,MAAM,yGAAE,CAAC,QAAQ,CAAC,UAAU;IACzC,OAAO,KAAK,KAAK,CAAC;AACpB;AAEO,eAAe,YAAY,MAAc;IAC9C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS;IACpC,IAAI;QACF,MAAM,yGAAE,CAAC,SAAS,CAAC,UAAU,KAAK,SAAS,CAAC,QAAQ,MAAM,IAAI;IAChE,EAAE,OAAM;IACN,mDAAmD;IACrD;AACF;AAEA,SAAS,kBAAkB,SAAiB,EAAE,QAAgB;IAC5D,MAAM,UAAU,IAAI;IACpB,KAAK,MAAM,KAAK,UAAW,QAAQ,GAAG,CAAC,EAAE,KAAK,CAAC,WAAW,IAAI;IAC9D,KAAK,MAAM,KAAK,SAAU,QAAQ,GAAG,CAAC,EAAE,KAAK,CAAC,WAAW,IAAI;IAC7D,OAAO,MAAM,IAAI,CAAC,QAAQ,MAAM;AAClC;AAEO,eAAe;IACpB,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS;IACpC,MAAM,OAAO,MAAM,yGAAE,CAAC,QAAQ,CAAC,UAAU;IACzC,MAAM,YAAoB,KAAK,KAAK,CAAC;IACrC,IAAI;QACF,MAAM,UAAU,MAAM,yGAAE,CAAC,QAAQ,CAAC,cAAc;QAChD,MAAM,WAAmB,KAAK,KAAK,CAAC;QACpC,OAAO,kBAAkB,WAAW;IACtC,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,WAAW,KAAa;IAC5C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS;IACpC,IAAI;IACJ,IAAI;QACF,MAAM,OAAO,MAAM,yGAAE,CAAC,QAAQ,CAAC,UAAU;QACzC,YAAY,KAAK,KAAK,CAAC;IACzB,EAAE,OAAM;QACN,YAAY,EAAE;IAChB;IACA,MAAM,SAAS,kBAAkB,WAAW;IAC5C,MAAM,yGAAE,CAAC,SAAS,CAAC,cAAc,KAAK,SAAS,CAAC,QAAQ,MAAM,IAAI;AACpE"}},
    {"offset": {"line": 138, "column": 0}, "map": {"version":3,"sources":["file:///Users/emil/Desktop/arcain/new/src/app/api/houses/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { readHouses, writeHouses } from \"@/lib/data\";\nimport type { House } from \"@/types\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const city = searchParams.get(\"city\");\n    const search = searchParams.get(\"search\")?.toLowerCase() || \"\";\n    const sort = searchParams.get(\"sort\") || \"price_asc\";\n    const roommateFriendly = searchParams.get(\"roommateFriendly\");\n    const type = searchParams.get(\"type\");\n    const builtType = searchParams.get(\"builtType\");\n    const priceMin = searchParams.get(\"priceMin\");\n    const priceMax = searchParams.get(\"priceMax\");\n    const region = searchParams.get(\"region\");\n    const renovated = searchParams.get(\"renovated\");\n    const areaMin = searchParams.get(\"areaMin\");\n    const areaMax = searchParams.get(\"areaMax\");\n    const floorMin = searchParams.get(\"floorMin\");\n    const floorMax = searchParams.get(\"floorMax\");\n    const rooms = searchParams.get(\"rooms\");\n    const page = Math.max(1, parseInt(searchParams.get(\"page\") || \"1\", 10));\n    const limit = Math.min(20, Math.max(1, parseInt(searchParams.get(\"limit\") || \"10\", 10)));\n    let houses = await readHouses();\n    if (city) houses = houses.filter((h: House) => h.city === city);\n    if (roommateFriendly === \"true\") houses = houses.filter((h: House) => h.roommateFriendly);\n    if (type) houses = houses.filter((h: House) => h.type === type);\n    if (builtType) houses = houses.filter((h: House) => h.builtType === builtType);\n    if (priceMin != null && priceMin !== \"\") houses = houses.filter((h: House) => h.price >= Number(priceMin));\n    if (priceMax != null && priceMax !== \"\") houses = houses.filter((h: House) => h.price <= Number(priceMax));\n    if (region) houses = houses.filter((h: House) => h.address?.toLowerCase() === region.toLowerCase());\n    if (renovated === \"true\") houses = houses.filter((h: House) => h.renovated);\n    if (renovated === \"false\") houses = houses.filter((h: House) => !h.renovated);\n    if (areaMin != null && areaMin !== \"\") houses = houses.filter((h: House) => (h.area ?? 0) >= Number(areaMin));\n    if (areaMax != null && areaMax !== \"\") houses = houses.filter((h: House) => (h.area ?? 0) <= Number(areaMax));\n    if (floorMin != null && floorMin !== \"\") houses = houses.filter((h: House) => (h.floor ?? 0) >= Number(floorMin));\n    if (floorMax != null && floorMax !== \"\") houses = houses.filter((h: House) => (h.floor ?? 0) <= Number(floorMax));\n    if (rooms != null && rooms !== \"\") {\n      const r = Number(rooms);\n      if (r === 4) houses = houses.filter((h: House) => h.rooms >= 4);\n      else houses = houses.filter((h: House) => h.rooms === r);\n    }\n    if (search) {\n      houses = houses.filter(\n        (h: House) =>\n          h.title.toLowerCase().includes(search) ||\n          (h.description && h.description.toLowerCase().includes(search)) ||\n          h.city.toLowerCase().includes(search) ||\n          (h.address && h.address.toLowerCase().includes(search))\n      );\n    }\n    if (sort === \"price_asc\") houses.sort((a: House, b: House) => a.price - b.price);\n    else if (sort === \"price_desc\") houses.sort((a: House, b: House) => b.price - a.price);\n    else if (sort === \"rating_desc\") houses.sort((a: House, b: House) => b.rating - a.rating);\n    else if (sort === \"rating_asc\") houses.sort((a: House, b: House) => a.rating - b.rating);\n    const total = houses.length;\n    const start = (page - 1) * limit;\n    const items = houses.slice(start, start + limit);\n    const regions = [...new Set((await readHouses()).map((h: House) => h.address).filter(Boolean))].sort();\n    return NextResponse.json({\n      items,\n      total,\n      page,\n      limit,\n      totalPages: Math.ceil(total / limit),\n      regions,\n    });\n  } catch {\n    return NextResponse.json({ error: \"Failed to load houses\" }, { status: 500 });\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const {\n      title,\n      city,\n      price,\n      rooms,\n      images,\n      rating,\n      description,\n      roommateFriendly,\n      type,\n      builtType,\n      address,\n      renovated,\n      area,\n      floor,\n    } = body;\n    if (!title || !city || price == null) {\n      return NextResponse.json({ error: \"Title, city and price required\" }, { status: 400 });\n    }\n    const houses = await readHouses();\n    const newHouse: House = {\n      id: String(houses.length + 1),\n      title: title || \"\",\n      city: city || \"\",\n      price: Number(price) || 0,\n      rooms: Number(rooms) || 1,\n      images: Array.isArray(images) ? images : [],\n      rating: Number(rating) || 0,\n      description: description || \"\",\n      roommateFriendly: Boolean(roommateFriendly),\n      type: type === \"house\" ? \"house\" : \"flat\",\n      builtType: builtType === \"old\" ? \"old\" : \"new\",\n      address: address ?? \"\",\n      renovated: Boolean(renovated),\n      area: Number(area) || 0,\n      floor: Number(floor) || 0,\n    };\n    houses.push(newHouse);\n    await writeHouses(houses);\n    return NextResponse.json(newHouse);\n  } catch {\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}